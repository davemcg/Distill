---
title: "Data Summary"
output: 
  html_notebook:
    theme: flatly
    toc: True
---

```{r}
library(tidyverse)
load('/Volumes/data/projects/nei/mcgaughey/eye_var_Pathogenicity/data/master/allX_2018_08_01.Rdata')
load('/Volumes/data/projects/nei/mcgaughey/eye_var_Pathogenicity/clean_data/all_data.2018_06_08.Rdata')
```

# DataSets
```{r}
allX$DataSet %>% table() %>% data.frame() %>% pull(1) %>% as.character() %>% str_split(.,'_') %>% lapply(., `[[`, 1) %>% unlist() %>% unique() %>% writeLines()
```

# ML set vs Validate set
```{r}
ML <- c('clinvar','UK10K','gnomad','Test Set', 'Train Set')
val <- c('DDL NISC RD Cohort','SuperGrimm','Homsy','Samocha','UniFun')

```

# ML
## Basic Stats
### Counts across type and status
```{r}
allX %>%
  filter(grepl(paste(ML,collapse='|'), DataSet)) %>%  
  select(DataSet, type, pos_id, Status) %>% unique() %>% 
  group_by(DataSet, type, Status) %>% 
  summarise(Count=n()) %>% 
  ggplot(aes(x=type,y=log2(Count), fill=Status, label=prettyNum(Count, big.mark=","))) + 
  geom_bar(stat='identity', position = 'dodge') + 
  facet_wrap(~DataSet) + 
  theme_minimal() + 
  ggsci::scale_fill_aaas() + coord_cartesian(ylim=c(0,23)) +
  geom_text(stat='identity', vjust=-1, position=position_dodge(width=1))
```

### Splicing
```{r}
allX %>% 
  filter(grepl(paste(ML,collapse='|'), DataSet)) %>%  
  select(DataSet, is_splicing, Status, pos_id) %>% unique() %>% 
  group_by(DataSet, is_splicing, Status) %>% 
  summarise(Count=n()) %>% 
  select(DataSet, Type = is_splicing, Status, Count) %>%
  ungroup() %>% 
  mutate(Type = case_when(Type==0 ~ 'Coding',
                          TRUE ~ 'Splicing')) %>% 
  ggplot(aes(x=Type,y=log2(Count), fill=Status, label=prettyNum(Count, big.mark=","))) +
  geom_bar(stat='identity', position = 'dodge') + 
  facet_wrap(~DataSet) + 
  theme_minimal() + 
  ggsci::scale_fill_aaas() + coord_cartesian(ylim=c(0,23)) +
  geom_text(stat='identity', vjust=-1, position=position_dodge(width=1))
```

# Validate
Since the `all` data set has the properly labeled DataSets, we'll use that as the ref and use the `allX` for the variant info
## Basic Stats
### Counts across type and status
```{r}
allX %>%
  filter(grepl(paste(val,collapse='|'), DataSet)) %>%  
  select(DataSet, type, pos_id, Status) %>% unique() %>% 
  group_by(DataSet, type, Status) %>% 
  summarise(Count=n()) %>% 
  ggplot(aes(x=type,y=log2(Count), fill=Status, label=prettyNum(Count, big.mark=","))) + 
  geom_bar(stat='identity', position = 'dodge') + 
  facet_wrap(~DataSet) + 
  theme_minimal() + 
  ggsci::scale_fill_aaas() + coord_cartesian(ylim=c(0,15)) +
  geom_text(stat='identity', vjust=-1, position=position_dodge(width=1))
```

### Splicing
```{r}
allX %>% 
  filter(grepl(paste(val,collapse='|'), DataSet)) %>%  
  select(DataSet, is_splicing, Status, pos_id) %>% unique() %>% 
  group_by(DataSet, is_splicing, Status) %>% 
  summarise(Count=n()) %>% 
  select(DataSet, Type = is_splicing, Status, Count) %>%
  ungroup() %>% 
  mutate(Type = case_when(Type==0 ~ 'Coding',
                          TRUE ~ 'Splicing')) %>% 
  ggplot(aes(x=Type,y=log2(Count), fill=Status, label=prettyNum(Count, big.mark=","))) +
  geom_bar(stat='identity', position = 'dodge') + 
  facet_wrap(~DataSet) + 
  theme_minimal() + 
  ggsci::scale_fill_aaas() + coord_cartesian(ylim=c(0,15)) +
  geom_text(stat='identity', vjust=-1, position=position_dodge(width=1))
```
